knitr::opts_chunk$set(
echo = TRUE,
message = TRUE,
warning = TRUE
)
options(scipen=999)
# load packages
library(pacman)
pacman::p_load(dplyr, nlme, ggplot2, tidyr, lubridate, psych, install = TRUE)
cas_dir = "/Volumes/psych-cog/dsnlab/TAG/"
proj_path = "/Volumes/psych-cog/dsnlab/TAG/projects/timing_tempo_tag/"
q_path = "/Volumes/psych-cog/dsnlab/TAG/behavior/Questionnaires/"
## for puberty self-report variables
puberty_sr <- read.csv(paste0(q_path, "Puberty/Allwaves_PubertyComposite_updated.csv")) %>%
mutate(tagid=as.factor(tagid),
wave=as.factor(wave)) %>%
select(tagid, wave, age, PBIP_1A, PBIP_2A, stage, pdss, PUBcomp)
age_at_menarche <- read.csv(paste0(q_path, "Puberty/Age_at_menarche.csv")) %>%
mutate(tagid = as.factor(tagid),
wave = as.factor(wave)) %>%
select(tagid, wave, age_menarche)
## IDs missing PUBcomp: TAG014 W1, TAG057 W1, TAG114 W1, TAG116 W3, TAG130 W1, TAG141 W1
## filtering puberty doc
puberty_sr <- puberty_sr %>%
filter(!is.na(age),
!is.na(stage))
df <- puberty_sr[,c("tagid", "wave", "age", "stage")]
df <- left_join(df, age_at_menarche, by = c("tagid", "wave"))
df <- df %>%
group_by(tagid) %>%
mutate(age_menarche = ifelse(is.na(age_menarche), first(age_menarche, na_rm = TRUE), age_menarche)) %>%
ungroup() %>%
mutate(age_menarche_c = age_menarche - mean(age_menarche, na.rm = TRUE))
## centering age by sample set mean
df$age_c <- (df$age - mean(df$age, na.rm = TRUE))
model <- nlme(
fixed = traject ~ b0 * (b1 - b0) / (1 + exp(-alpha * (age - lambda))),
data = datalog,
start = c(b0 = 1, b1 = 5, alpha = 0.9, lambda = 13.5),
lower = c(b0 = 1, b1 = 1, alpha = -Inf, lambda = -Inf),
upper = c(b0 = Inf, b1 = 5, alpha = Inf, lambda = Inf),
control = nlme::lmeControl(opt = "optim")
)
model <- nlme(
fixed = traject ~ b0 * (b1 - b0) / (1 + exp(-alpha * (age - lambda))),
data = df,
start = c(b0 = 1, b1 = 5, alpha = 0.9, lambda = 13.5),
lower = c(b0 = 1, b1 = 1, alpha = -Inf, lambda = -Inf),
upper = c(b0 = Inf, b1 = 5, alpha = Inf, lambda = Inf),
control = nlme::lmeControl(opt = "optim")
)
formula <- traject ~ 1 + (1 | tagid)  # id is the subject identifier
# Set initial values for parameters
start_values <- list(
m_alpha = 0.9,
m_lambda = 13.5,
v_e = 1.0,
v_alpha = 1.0,
cov_alam = 0.3,
v_lambda = 1.5
)
# Fit the mixed-effects model
model <- lmer(formula, data = df, REML = FALSE, start = start_values)
# Fit the mixed-effects model
model <- nlme::lmer(formula, data = df, REML = FALSE, start = start_values)
# Fit the mixed-effects model
model <- lme4::lmer(formula, data = df, REML = FALSE, start = start_values)
formula <- stage ~ 1 + (1 | tagid)  # id is the subject identifier
# Fit the mixed-effects model
model <- lme4::lmer(formula, data = df, REML = FALSE, start = start_values)
# Set initial values for parameters
start_values <- list(
alpha = 0.9,
lambda = 13.5,
v_e = 1.0,
v_alpha = 1.0,
cov_alam = 0.3,
v_lambda = 1.5
)
# Fit the mixed-effects model
model <- lme4::lmer(formula, data = df, REML = FALSE, start = start_values)
# Define the logistic growth model
logistic_growth <- function(alpha, lambda, age) {
1 / (1 + exp(-alpha * (age - lambda)))
}
# Create a model formula
formula <- traject ~ logistic_growth(alpha, lambda, age)  # Define your formula
# Set initial values for parameters
start_values <- list(
alpha = 0.9,
lambda = 13.5,
v_e = 1.0
)
# Fit the nonlinear mixed-effects model
model <- nlme(formula, data = data, fixed = list(alpha + lambda ~ 1), random = list(alpha ~ 1, lambda ~ 1), start = start_values)
# Define the logistic growth model
logistic_growth <- function(alpha, lambda, age) {
1 / (1 + exp(-alpha * (age - lambda)))
}
# Create a model formula
formula <- stage ~ logistic_growth(alpha, lambda, age)  # Define your formula
# Set initial values for parameters
start_values <- list(
alpha = 0.9,
lambda = 13.5,
v_e = 1.0
)
# Fit the nonlinear mixed-effects model
model <- nlme(formula, data = df, fixed = list(alpha + lambda ~ 1), random = list(alpha ~ 1, lambda ~ 1), start = start_values)
# Fit the nonlinear mixed-effects model
model <- nlme(formula, data = df, fixed = stage ~ alpha + lambda - 1, random = pdDiag(alpha + lambda ~ 1), start = start_values, control = list(maxIter = 100))
# Define the logistic growth model
logistic_growth <- function(alpha, lambda, age) {
1 / (1 + exp(-alpha * (age - lambda)))
}
# Create a model formula
formula <- stage ~ logistic_growth(alpha, lambda, age) | tagid
# Set initial values for parameters
start_values <- list(
alpha = 0.9,
lambda = 13.5,
v_e = 1.0
)
# Fit the nonlinear mixed-effects model
model <- nlme(formula, data = df, fixed = alpha + lambda ~ 1, start = start_values)
# Fit the nonlinear mixed-effects model
model <- nlme(stage ~ 1 + (5 - 1) * exp(-(alpha*(age-lambda))),
start(list(alpha = .9, lambda = 13.5)), data = df)
# Fit the nonlinear mixed-effects model
model <- nls(stage ~ 1 + (5 - 1) * exp(-(alpha*(age-lambda))),
start(list(alpha = .9, lambda = 13.5)), data = df)
# Fit the nonlinear mixed-effects model
model <- nls(stage ~ 1 + (5 - 1) * exp(-(alpha*(age-lambda))),
start = list(alpha = 0.9, lambda = 13.5), data = df)
logistic_growth_model <- nls(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))),
data = df,
start = list(b0 = 1, b1 = 5, alpha = 0.9, lambda = 13.5))
summary(logistic_growth_model)
logistic_growth_model <- nlme(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))),
fixed = list(b0 + b1 + alpha + lambda ~ 1),
random = list(tagid = pdIdent(tagid), wave = pdIdent(wave)),
data = df,
start = list(b0 = 1, b1 = 5, alpha = 0.9, lambda = 13.5))
logistic_growth_model <- nlme(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))),
fixed = list(b0 + b1 + alpha + lambda ~ 1),
random = list(id = pdIdent(tagid), wave = pdIdent(wave)),
data = df,
start = list(b0 = 1, b1 = 5, alpha = 0.9, lambda = 13.5))
View(df)
logistic_growth_model <- nlme(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))),
fixed = list(b0 + b1 + alpha + lambda ~ 1),
random = pdBlocked(list(tagid = pdIdent(), wave = pdIdent())),
data = df,
start = list(b0 = 1, b1 = 5, alpha = 0.9, lambda = 13.5))
logistic_growth_model <- nlme(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))),
fixed = list(b0 + b1 + alpha + lambda ~ 1),
andom = list(tagid = pdIdent(form = ~1), wave = pdIdent(form = ~1)),
data = df,
start = list(b0 = 1, b1 = 5, alpha = 0.9, lambda = 13.5))
logistic_growth_model <- nlme(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))),
fixed = list(b0 + b1 + alpha + lambda ~ 1),
random = list(tagid = pdIdent(form = ~1), wave = pdIdent(form = ~1)),
data = df,
start = list(b0 = 1, b1 = 5, alpha = 0.9, lambda = 13.5))
logistic_growth_model <- nlme(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))),
fixed = list(b0 + b1 + alpha + lambda ~ 1),
random = list(tagid = pdIdent(form = ~1), wave = pdIdent(form = ~1)),
data = df,
start = list(b0 = 1, b1 = 5, alpha = 0.9, lambda = 13.5))
logistic_growth_model <- nlme(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))) + (1|tagid) + (1|wave),
fixed = list(b0 + b1 + alpha + lambda ~ 1),
random = list(tagid = pdIdent(form = ~1), wave = pdIdent(form = ~1)),
data = df,
start = list(b0 = 1, b1 = 5, alpha = 0.9, lambda = 13.5))
logistic_growth_model <- nlme(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))) + (1|tagid) + (1|wave),
fixed = list(b0 + b1 + alpha + lambda ~ 1),
data = df,
start = list(b0 = 1, b1 = 5, alpha = 0.9, lambda = 13.5))
logistic_growth_model <- nlme(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))) + (1|tagid) + (1|wave),
data = df,
start = list(b0 = 1, b1 = 5, alpha = 0.9, lambda = 13.5))
logistic_growth_model <- nlme(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))),
fixed = list(b0 + b1 + alpha + lambda ~ 1),
random = list(tagid = pdIdent(form = ~1), wave = pdIdent(form = ~1)),
data = df,
start = c(b0 = 1, b1 = 5, alpha = 0.9, lambda = 13.5))
logistic_growth_model <- nls(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))),
data = df,
start = list(b0 = 1, b1 = 5, alpha = 0.9, lambda = 13.5))
mixed_model <- glmer(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))) + (1 | tagid) + (1 | wave),
data = df,
family = binomial(),
control = glmerControl(optimizer = "bobyqa"),
nAGQ = 1,  # Number of points in adaptive Gaussian quadrature
start = list(b0 = 1, b1 = 5, alpha = 0.9, lambda = 13.5))
mixed_model <- lme4::glmer(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))) + (1 | tagid) + (1 | wave),
data = df,
family = binomial(),
control = glmerControl(optimizer = "bobyqa"),
nAGQ = 1,  # Number of points in adaptive Gaussian quadrature
start = list(b0 = 1, b1 = 5, alpha = 0.9, lambda = 13.5))
random_growth_model <- nlme(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))),
data = df,
fixed = b0 + b1 + alpha + lambda ~ 1,
random = pdDiag(b0 + b1 + alpha + lambda ~ 1 | tagid),
start = list(b0 = 1, b1 = 5, alpha = 0.9, lambda = 13.5))
str(df)
random_growth_model <- nlme(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))),
data = df,
fixed = b0 + b1 + alpha + lambda ~ 1,
random = pdDiag(b0 + b1 + alpha + lambda ~ 1 | wave),
start = list(b0 = 1, b1 = 5, alpha = 0.9, lambda = 13.5))
logistic_growth_model <- nls(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))),
data = df,
start = list(b0 = 1, b1 = 5, alpha = 0.9, lambda = 13.5))
logistic_growth_model <- nls(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))) + (1 | tagid) + (1 | wave)),
logistic_growth_model <- nls(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))) + (1 | tagid) + (1 | wave)),
logistic_growth_model <- nls(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))) + (1 | tagid) + (1 | wave)),
logistic_growth_model <- nls(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))) + (1 | tagid) + (1 | wave))),
logistic_growth_model <- nls(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))) + (1 | tagid) + (1 | wave)),
logistic_growth_model <- nls(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))) + (1 | tagid) + (1 | wave),
data = df,
start = list(b0 = 1, b1 = 5, alpha = 0.9, lambda = 13.5))
logistic_growth_model <- glmer(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))) + (1 | tagid) + (1 | wave),
data = df,
start = list(b0 = 1, b1 = 5, alpha = 0.9, lambda = 13.5),
family = binomial())
logistic_growth_model <- lme4::glmer(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))) + (1 | tagid) + (1 | wave),
data = df,
start = list(b0 = 1, b1 = 5, alpha = 0.9, lambda = 13.5),
family = binomial())
logistic_growth_model <- glmer(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))) + (1 | tagid) + (1 | wave),
data = df,
family = binomial,
start = list(b0 = 1, b1 = 5, alpha = 0.9, lambda = 13.5))
logistic_growth_model <- lme4::glmer(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))) + (1 | tagid) + (1 | wave),
data = df,
family = binomial,
start = list(b0 = 1, b1 = 5, alpha = 0.9, lambda = 13.5))
b0 = 1
b1 = 5
logistic_growth_model <- lme4::glmer(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))) + (1 | tagid) + (1 | wave),
data = df,
family = binomial,
start = list(b0 = 1, b1 = 5, alpha = 0.9, lambda = 13.5))
logistic_growth_model <- lme4::glmer(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))) + (1 | tagid) + (1 | wave),
data = df,
family = binomial,
start = list(alpha = 0.9, lambda = 13.5))
logistic_growth_model <- lme4::glmer(stage ~ b0 + (b1 - b0) / (1 + exp(-I(alpha) * (age - lambda))) + (1 | tagid) + (1 | wave),
data = df,
family = binomial,
start = list(alpha = 0.9, lambda = 13.5))
logistic_growth_model <- lme4::glmer(stage ~ b0 + (b1 - b0) / (1 + exp(-I(alpha) * (age - lambda))) + (1 | tagid) + (1 | wave),
data = df,
family = binomial,
start = list(alpha = 0.9, lambda = 13.5),
control = glmerControl(optimizer = "bobyqa", optCtrl = list(maxfun = 1000, tol = 1e-8, iter.max = 1e5), nAGQ = 0)))
logistic_growth_model <- lme4::glmer(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))) + (1 | tagid) + (1 | wave),
data = df,
family = binomial,
start = list(alpha = 0.9, lambda = 13.5),
control = glmerControl(optimizer = "bobyqa", optCtrl = list(maxfun = 1000, tol = 1e-8, iter.max = 1e5), nAGQ = 0))
install.packages("lme4")
install.packages("lme4")
knitr::opts_chunk$set(
echo = TRUE,
message = TRUE,
warning = TRUE
)
options(scipen=999)
logistic_growth_model <- lme4::glmer(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))) + (1 | tagid) + (1 | wave),
data = df,
family = binomial,
start = list(alpha = 0.9, lambda = 13.5),
control = glmerControl(optimizer = "bobyqa", optCtrl = list(maxfun = 1000, tol = 1e-8, iter.max = 1e5), nAGQ = 0))
logistic_growth_model <- lme4::glmer(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))) + (1 | tagid) + (1 | wave),
data = df,
family = binomial,
start = list(alpha = 0.9, lambda = 13.5))
logistic_growth_model <- nls(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))),
data = df,
start = list(alpha = 0.9, lambda = 13.5))
logistic_growth_model <- gnls(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))),
params = b0 + b1 + alpha + lambda ~ 1,
data = df,
start = list(alpha = 0.9, lambda = 13.5))
logistic_growth_model <- nlme::gnls(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))),
params = b0 + b1 + alpha + lambda ~ 1,
data = df,
start = list(alpha = 0.9, lambda = 13.5))
logistic_growth_model <- nlme::gnls(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))),
params = b0 + b1 + alpha + lambda ~ 1,
data = df,
start = list(b0 = 1, b1 = 5, alpha = 0.9, lambda = 13.5))
summary(logistic_growth_model)
random_effects <- corAR1(form = ~ 1 | tagid) +
corAR1(form = ~ 1 | wave)
random_effects <- nlme::corAR1(form = ~ 1 | tagid) +
nlme::corAR1(form = ~ 1 | wave)
# Fit the model with random effects
model_with_random_effects <- nlme::gnls(logistic_growth_model,
corr = random_effects)
random_effects <- nlme(logistic_growth_model, random = list(tagid = pdDiag(~1), wave = pdDiag(~1)))
random_effects <- nlme::nlme(logistic_growth_model, random = list(tagid = pdDiag(~1), wave = pdDiag(~1)))
random_effects <- nlme::lme(logistic_growth_model, random = list(tagid = pdDiag(~1), wave = pdDiag(~1)))
logistic_growth_model <- nls(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))),
params = b0 + b1 + alpha + lambda ~ 1,
data = df,
start = list(b0 = 1, b1 = 5, alpha = 0.9, lambda = 13.5))
logistic_growth_model <- nls(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))),
data = df,
start = list(b0 = 1, b1 = 5, alpha = 0.9, lambda = 13.5))
random_effects <- nlme::lme(logistic_growth_model, random = list(tagid = pdDiag(~1), wave = pdDiag(~1)))
logistic_growth_model <- nlme::gnls(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))),
params = b0 + b1 + alpha + lambda ~ 1,
data = df,
start = list(b0 = 1, b1 = 5, alpha = 0.9, lambda = 13.5))
summary(logistic_growth_model)
logistic_growth_model <- nls(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))),
data = df,
start = list(b0 = 1, b1 = 5, alpha = 0.9, lambda = 13.5))
summary(logistic_growth_model)
random_effects <- nlme::corAR1(form = ~ 1 | tagid) +
nlme::corAR1(form = ~ 1 | wave)
# Fit the model with random effects
model_with_random_effects <- nlme::nls(logistic_growth_model,
corr = random_effects)
# Fit the model with random effects
model_with_random_effects <- nls(logistic_growth_model,
corr = random_effects)
### SELF REPORT
b0 = 1
b1 = 5
logistic_growth_model <- nls(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))),
data = df,
start = list(alpha = 0.9, lambda = 13.5))
summary(logistic_growth_model)
