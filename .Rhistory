library(pacman)
pacman::p_load(dplyr, nlme, ggplot2, tidyr, lubridate, psych, install = TRUE)
cas_dir = "/Volumes/psych-cog/dsnlab/TAG/"
proj_path = "/Volumes/psych-cog/dsnlab/TAG/projects/timing_tempo_tag/"
q_path = "/Volumes/psych-cog/dsnlab/TAG/behavior/Questionnaires/"
puberty_sr <- read.csv("~/Desktop/Allwaves_PubertyComposite_updated.csv") %>%
mutate(tagid=as.factor(tagid),
wave=as.factor(wave)) %>%
select(tagid, wave, age, PBIP_1A, PBIP_2A, stage, pdss, PUBcomp)
puberty_sr <- puberty_sr %>%
filter(!is.na(age),
!is.na(stage))
df <- puberty_sr[,c("tagid", "wave", "age", "stage")]
df <- left_join(df, age_at_menarche, by = c("tagid", "wave"))
### SELF REPORT
b0 = 1
b1 = 5
logistic_growth_model <- nlme(stage ~ b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda))),
data = df,
random = pdDiag(alpha + lambda ~ tagid),
fixed = list(b0 = 1, b1 = 5),
start = list(alpha = 0.9, lambda = 13.5))
View(df)
str(df)
logistic_growth_model <- nlme(stage ~ logistic_growth(1,5,alpha,lambda),
data = df,
random = pdDiag(alpha + lambda ~ tagid),
fixed = list(b0 = 1, b1 = 5),
start = list(alpha = 0.9, lambda = 13.5))
b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda)))
logistic_growth <- function(b0, b1, alpha, lambda) {
b0 + (b1 - b0) / (1 + exp(-alpha * (age - lambda)))
}
logistic_growth_model <- nlme(stage ~ logistic_growth(1,5,alpha,lambda),
data = df,
random = pdDiag(alpha + lambda ~ tagid),
fixed = list(b0 = 1, b1 = 5),
start = list(alpha = 0.9, lambda = 13.5))
logistic_growth_model <- nlme(stage ~ logistic_growth,
data = df,
random = pdDiag(alpha + lambda ~ tagid),
fixed = list(b0 = 1, b1 = 5),
start = list(alpha = 0.9, lambda = 13.5))
logistic_growth <- function(age, b0, b1, alpha, lambda) {
logistic_growth <- function(age, b0, b1, alpha, lambda) {
lambda / (1 + alpha * exp(-(b0 + b1 * age)))
}
logistic_growth <- function(age, b0, b1, alpha, lambda) {
lambda / (1 + alpha * exp(-(b0 + b1 * age)))
}
### SELF REPORT
b0 = 1
b1 = 5
logistic_growth <- function(age, b0, b1, alpha, lambda) {
lambda / (1 + alpha * exp(-(b0 + b1 * age)))
}
fit <- nlme(logistic_growth(stage ~ lambda / (1 + alpha * exp(-(b0 + b1 * age))),
fixed = lambda + alpha ~ 1,
random = pdCompSymm(list(~ 1 | age / tagid)),
start = c(lambda = 13.5, alpha = 0.9),
data = df))
fit <- nlme(logistic_growth(stage ~ lambda / (1 + alpha * exp(-(b0 + b1 * age))),
fixed = lambda + alpha ~ 1,
random = pdCompSymm(list(~ 1 | age, tagid)),
start = c(lambda = 13.5, alpha = 0.9),
data = df))
### SELF REPORT
# Fixed values for b0 and b1
b0 <- 1
b1 <- 5
# Define the logistic growth model function with fixed b0 and b1
logistic_growth <- function(age, b0, b1, alpha, lambda) {
lambda / (1 + alpha * exp(-(b0 + b1 * age)))
}
# Fit the mixed-effects non-linear logistic growth model
fit <- nlme(
stage ~ logistic_growth(age, b0, b1, alpha, lambda),
fixed = stage ~ lambda + alpha,
random = pdCompSymm(list(age = pdIdent(form = ~1), tagid = pdIdent(form = ~1)),
start = c(lambda = 13.5, alpha = 0.9),
data = df
))
### SELF REPORT
# Fixed values for b0 and b1
b0 <- 1
b1 <- 5
# Define the logistic growth model function with fixed b0 and b1
logistic_growth <- function(age, b0, b1, alpha, lambda) {
lambda / (1 + alpha * exp(-(b0 + b1 * age)))
}
# Starting values for fixed effects
start_values <- list(lambda = 13.5, alpha = 0.9)
# Fit the mixed-effects non-linear logistic growth model
fit <- nlme(
stage ~ logistic_growth(age, b0, b1, alpha, lambda),
fixed = stage ~ lambda + alpha,
random = pdCompSymm(list(age = pdIdent(form = ~1), tagid = pdIdent(form = ~1)),
start = start_values,  # Specify starting values for fixed effects here
data = df
))
# Define the logistic growth model function with fixed b0 and b1
logistic_growth <- function(age, b0, b1, alpha, lambda) {
lambda / (1 + alpha * exp(-(b0 + b1 * age)))
}
# Starting values for fixed effects
start_values_fixed <- list(lambda = 13.5, alpha = 0.9)
# Starting values for random effects
start_values_random <- list(age = 0, tagid = 0)  # You may adjust these starting values
# Fit the mixed-effects non-linear logistic growth model
fit <- nlme(
stage ~ logistic_growth(age, b0, b1, alpha, lambda),
fixed = stage ~ lambda + alpha,
random = pdCompSymm(list(age = pdIdent(form = ~1), tagid = pdIdent(form = ~1)),
start = c(start_values_fixed, start_values_random),  # Combine starting values
data = df
))
knitr::opts_chunk$set(
echo = TRUE,
message = TRUE,
warning = TRUE
)
options(scipen=999)
# load packages
library(pacman)
pacman::p_load(dplyr, nlme, ggplot2, tidyr, lubridate, psych, install = TRUE)
puberty_sr <- read.csv("Allwaves_PubertyComposite_updated.csv") %>%
mutate(tagid=as.factor(tagid),
wave=as.factor(wave)) %>%
select(tagid, wave, age, PBIP_1A, PBIP_2A, stage, pdss, PUBcomp)
### SELF REPORT
b0 = 1
b1 = 5
logistic_growth <- function(age, b0, b1, alpha, lambda) {
lambda / (1 + alpha * exp(-(b0 + b1 * age)))
}
fit <- nlme(logistic_growth(stage ~ lambda / (1 + alpha * exp(-(b0 + b1 * age))),
fixed = lambda + alpha ~ 1,
random = pdCompSymm(list(~ 1 | age / tagid)),
start = c(lambda = 100, alpha = 0.1),
data = df))
## try in nlme again but just make b1 = 5, b0 = 1
## create a timepoint var, just order per ID (wave is arbitrary)
ctrl <- nlmeControl(maxIter)
logistic_growth <- function(age, lambda, alpha) {
lambda / (1 + alpha * exp(-(b0 + b1 * age)))
}
# Assuming df is your data frame with columns 'stage' and 'age'
fit <- nlme(stage ~ logistic_growth(age, lambda, alpha),
fixed = lambda + alpha ~ 1,
random = pdCompSymm(list(~ 1 | age / tagid)),
start = c(lambda = 100, alpha = 0.1),
data = df)
# Assuming df is your data frame with columns 'stage' and 'age'
fit <- nlme(stage ~ logistic_growth(age, lambda, alpha),
fixed = lambda + alpha ~ 1,
random = pdCompSymm(list(~ 1 | tagid)),
start = c(lambda = 100, alpha = 0.1),
data = df)
# Assuming df is your data frame with columns 'stage' and 'age'
fit <- nlme(stage ~ logistic_growth(age, lambda, alpha),
fixed = lambda + alpha ~ 1,
random = pdCompSymm(list(~ 1 | tagid)),
start = c(lambda = 100, alpha = 0.1),
data = df)
str(puberty_sr)
knitr::opts_chunk$set(
echo = TRUE,
message = TRUE,
warning = TRUE
)
options(scipen=999)
# load packages
library(pacman)
pacman::p_load(dplyr, nlme, ggplot2, tidyr, lubridate, psych, install = TRUE)
cas_dir = "/Volumes/psych-cog/dsnlab/TAG/"
proj_path = "/Volumes/psych-cog/dsnlab/TAG/projects/timing_tempo_tag/"
q_path = "/Volumes/psych-cog/dsnlab/TAG/behavior/Questionnaires/"
## for puberty self-report variables
puberty_sr <- read.csv("~/Desktop/Allwaves_PubertyComposite_updated.csv") %>%
mutate(tagid=as.factor(tagid),
wave=as.factor(wave)) %>%
select(tagid, wave, age, PBIP_1A, PBIP_2A, stage, pdss, PUBcomp)
puberty_sr <- read.csv("~/Users/clare/Dropbox (University of Oregon)/mine/projects/tag_timing_tempo/Allwaves_PubertyComposite_updated.csv") %>%
mutate(tagid=as.factor(tagid),
wave=as.factor(wave)) %>%
select(tagid, wave, age, PBIP_1A, PBIP_2A, stage, pdss, PUBcomp)
puberty_sr <- read.csv("~/Users/clare/Dropbox (University of Oregon)/mine/projects/timing_tempo_tag/Allwaves_PubertyComposite_updated.csv") %>%
mutate(tagid=as.factor(tagid),
wave=as.factor(wave)) %>%
select(tagid, wave, age, PBIP_1A, PBIP_2A, stage, pdss, PUBcomp)
puberty_sr <- read.csv("Allwaves_PubertyComposite_updated.csv") %>%
mutate(tagid=as.factor(tagid),
wave=as.factor(wave)) %>%
select(tagid, wave, age, PBIP_1A, PBIP_2A, stage, pdss, PUBcomp)
b0 = 1
b1 = 5
logistic_growth <- function(age, b0, b1, alpha, lambda) {
lambda / (1 + alpha * exp(-(b0 + b1 * age)))
}
fit <- nlme(logistic_growth(stage ~ lambda / (1 + alpha * exp(-(b0 + b1 * age))),
fixed = lambda + alpha ~ 1,
random = pdCompSymm(list(~ 1 | age / tagid)),
start = c(lambda = 100, alpha = 0.1),
data = df))
## try in nlme again but just make b1 = 5, b0 = 1
## create a timepoint var, just order per ID (wave is arbitrary)
ctrl <- nlmeControl(maxIter)
glmer_out <- lme4::glmer(stage ~ age + (1 |tagid), family = "binomial", data = df )
glmer_out <- lme4::glmer(stage ~ age + (1 |tagid), family = "binomial", data = puberty_sr )
glmer_out <- lme4::glmer(stage ~ age + (1 |tagid), family = "mononomial", data = puberty_sr )
glmer_out <- lme4::glmer(stage ~ age + (1 |tagid), family = "guassian", data = puberty_sr )
glmer_out <- lme4::glmer(stage ~ age + (1 |tagid), family = "gaussian", data = puberty_sr )
summary(glmer_out)
### SELF REPORT
b0 = 1
b1 = 5
logistic_growth <- function(age, b0, b1, alpha, lambda) {
lambda / (1 + alpha * exp(-(b0 + b1 * age)))
}
fit <- nlme(logistic_growth(stage ~ lambda / (1 + alpha * exp(-(b0 + b1 * age))),
fixed = lambda + alpha ~ 1,
random = pdCompSymm(list(~ 1 | age / tagid)),
start = c(lambda = 100, alpha = 0.1),
data = puberty_sr))
fit <- nlme(logistic_growth(stage ~ lambda / (1 + alpha * exp(-(b0 + b1 * age))),
fixed = lambda + alpha ~ 1,
random = pdCompSymm(list(~ 1 | tagid)),
start = c(lambda = 100, alpha = 0.1),
data = puberty_sr))
nlme_fit <- nlme::nlme(stage ~ 1 + (5 - 1) / (1 + exp(-alpha * (age - lambda))),
data = puberty_sr,
fixed = alpha + lambda ~ 1 | tagid,
random = alpha + lambda ~ 1,
start = c(alpha = 0.9, lambda = 13.5),
nlmeControl(maxIter=180))
puberty_sr <- puberty_sr %>%
filter(!is.na(stage))
nlme_fit <- nlme::nlme(stage ~ 1 + (5 - 1) / (1 + exp(-alpha * (age - lambda))),
data = puberty_sr,
fixed = alpha + lambda ~ 1 | tagid,
random = alpha + lambda ~ 1,
start = c(alpha = 0.9, lambda = 13.5),
nlmeControl(maxIter=180))
puberty_sr <- puberty_sr %>%
filter(!is.na(stage),
!is.na(age))
nlme_fit <- nlme::nlme(stage ~ 1 + (5 - 1) / (1 + exp(-alpha * (age - lambda))),
data = puberty_sr,
fixed = alpha + lambda ~ 1 | tagid,
random = alpha + lambda ~ 1,
start = c(alpha = 0.9, lambda = 13.5),
nlmeControl(maxIter=180))
nlme_fit <- nlme::nlme(stage ~ 1 + (5 - 1) / (1 + exp(-alpha * (age - lambda))),
data = puberty_sr,
fixed = alpha + lambda ~ 1,  # Fixed effects
random = pdDiag(alpha + lambda ~ 1 | tagid),  # Random effects
start = c(alpha = 0.9, lambda = 13.5),
nlmeControl(maxIter = 180))
nlme_fit <- nlme::nlme(stage ~ 1 + (5 - 1) / (1 + exp(-alpha * (age - lambda))),
data = puberty_sr,
fixed = alpha + lambda ~ 1,  # Fixed effects
random = list(tagid = pdDiag(~ alpha + lambda - 1)),  # Random effects
start = c(alpha = 0.9, lambda = 13.5),
nlmeControl(maxIter = 180))
nlme_fit <- nlme::nlme(stage ~ 1 + (5 - 1) / (1 + exp(-alpha * (age - lambda))),
data = puberty_sr,
fixed = alpha + lambda ~ 1,  # Fixed effects
random = list(tagid = pdDiag(alpha + lambda ~ 1)),  # Random effects
start = c(alpha = 0.9, lambda = 13.5),
nlmeControl(maxIter = 180))
fit <- nlme(logistic_growth(stage ~ lambda / (1 + alpha * exp(-(b0 + b1 * age))),
fixed = lambda + alpha ~ 1,
random = lambda + alpha ~ 1,
groups = ~ tagid,
start = c(lambda = 100, alpha = 0.1),
data = puberty_sr))
nlme_fit <- nlme::nlme(stage ~ 1 + (5 - 1) / (1 + exp(-alpha * (age - lambda))),
data = puberty_sr,
fixed = alpha + lambda ~ 1,
random = alpha + lambda ~ 1,
start = c(alpha = 0.9, lambda = 13.5),
nlmeControl(maxIter=180))
nlme_fit <- nlme::nlme(stage ~ 1 + (5 - 1) / (1 + exp(-alpha * (age - lambda))),
data = puberty_sr,
fixed = alpha + lambda ~ 1,
random = alpha + lambda ~ 1,
groups = tagid,
start = c(alpha = 0.9, lambda = 13.5),
nlmeControl(maxIter=180))
View(puberty_sr)
nlme_fit <- nlme::nlme(stage ~ 1 + (5 - 1) / (1 + exp(-alpha * (age - lambda))),
data = puberty_sr,
fixed = alpha + lambda ~ 1,
random = alpha + lambda ~ 1,
groups = ~ tagid,
start = c(alpha = 0.9, lambda = 13.5),
nlmeControl(maxIter=180))
nlme_fit <- nlme::nlme(stage ~ 1 + (5 - 1) / (1 + exp(-alpha * (age - lambda))),
data = puberty_sr,
fixed = alpha + lambda ~ 1,
random = list(tagid = pdDiag(alpha + lambda ~ 1)),
groups = ~tagid,
start = c(alpha = 0.9, lambda = 13.5),
nlmeControl(maxIter = 180))
nlme_fit <- nlme::nlme(stage ~ 1 + (5 - 1) / (1 + exp(-alpha * (age - lambda))),
data = puberty_sr,
fixed = list(alpha ~ 1, lambda ~ 1),
random = alpha + lambda ~ 1 |tagid/age,
groups = ~tagid,
start = c(alpha = 0.9, lambda = 13.5),
nlmeControl(maxIter = 180))
knitr::opts_chunk$set(
echo = TRUE,
message = TRUE,
warning = TRUE
)
options(scipen=999)
# load packages
library(pacman)
pacman::p_load(dplyr, nlme, ggplot2, tidyr, lubridate, psych, install = TRUE)
cas_dir = "/Volumes/psych-cog/dsnlab/TAG/"
proj_path = "/Volumes/psych-cog/dsnlab/TAG/projects/timing_tempo_tag/"
q_path = "/Volumes/psych-cog/dsnlab/TAG/behavior/Questionnaires/"
puberty_sr <- read.csv("Allwaves_PubertyComposite_updated.csv") %>%
mutate(tagid=as.factor(tagid),
wave=as.factor(wave)) %>%
select(tagid, wave, age, PBIP_1A, PBIP_2A, stage, pdss, PUBcomp)
puberty_sr <- puberty_sr %>%
filter(!is.na(age),
!is.na(stage))
df <- puberty_sr[,c("tagid", "wave", "age", "stage")]
df <- left_join(df, age_at_menarche, by = c("tagid", "wave"))
df$age_c <- (df$age - mean(df$age, na.rm = TRUE))
### SELF REPORT
b0 = 1
b1 = 5
logistic_growth <- function(age, b0, b1, alpha, lambda) {
lambda / (1 + alpha * exp(-(b0 + b1 * age)))
}
fit <- nlme(logistic_growth(stage ~ lambda / (1 + alpha * exp(-(b0 + b1 * age))),
fixed = lambda + alpha ~ 1,
random = lambda + alpha ~ 1,
groups = ~ tagid,
start = c(lambda = 100, alpha = 0.1),
data = puberty_sr))
### SELF REPORT
b0 = 1
b1 = 5
logistic_growth <- function(age, b0, b1, alpha, lambda) {
lambda / (1 + alpha * exp(-(b0 + b1 * age)))
}
fit <- nlme(
fixed = stage ~ logistic_growth(age, b0, b1, alpha, lambda),
random = list(lambda + alpha ~ 1),
groups = ~ tagid,
start = c(lambda = 100, alpha = 0.1),
data = puberty_sr
)
### SELF REPORT
b0 = 1
b1 = 5
logistic_growth <- function(age, b0, b1, alpha, lambda) {
lambda / (1 + alpha * exp(-(b0 + b1 * age)))
}
fit <- nlme(
fixed = stage ~ logistic_growth(age, b0, b1, alpha, lambda),
random = list(tagid = pdCompSymm(lambda + alpha ~ 1)),
start = c(lambda = 100, alpha = 0.1),
data = puberty_sr
)
# Sample data
puberty_sr <- data.frame(
age = c(1, 2, 3, 4, 5),
stage = c(10, 20, 30, 40, 50),
tagid = rep(1, 5)  # Replace with your actual grouping variable
)
# Initial parameter values
b0 = 1
b1 = 5
logistic_growth <- function(age, b0, b1, alpha, lambda) {
lambda / (1 + alpha * exp(-(b0 + b1 * age)))
}
# Initial parameter values
initial_values <- c(lambda = 100, alpha = 0.1)
# Fit the model
fit <- nlme(
fixed = stage ~ logistic_growth(age, b0, b1, alpha, lambda) ~ 1,
random = pdCompSymm(~ 1),
groups = ~ tagid,
start = initial_values,
data = puberty_sr
)
puberty_sr <- read.csv("Allwaves_PubertyComposite_updated.csv") %>%
mutate(tagid=as.factor(tagid),
wave=as.factor(wave)) %>%
select(tagid, wave, age, PBIP_1A, PBIP_2A, stage, pdss, PUBcomp)
puberty_sr <- puberty_sr %>%
filter(!is.na(age),
!is.na(stage))
df <- puberty_sr[,c("tagid", "wave", "age", "stage")]
View(puberty_sr)
puberty_sr_wide <- puberty_sr %>%
select(tagid, age, wave, stage) %>%
pivot_wider(names_from = wave, values_from = stage) %>%
rename_at(vars(`0`, `1`, `2`, `3`), function(x) glue::glue('stage_{x}'))
View(puberty_sr)
puberty_sr_wide <- puberty_sr %>%
select(tagid, age, wave, stage) %>%
pivot_wider(names_from = wave, values_from = stage, values_fn = list(stage = list)) %>%
rename_at(vars(`0`, `1`, `2`, `3`), function(x) glue::glue('stage_{x}'))
puberty_sr_wide <- puberty_sr %>%
pivot_wider(
names_from = wave,
values_from = stage,
names_prefix = "stage_"
)
puberty_sr_wide <- puberty_sr %>%
pivot_wider(
names_from = wave,
values_from = stage,
names_prefix = "stage_",
values_fn = list
)
View(puberty_sr_wide)
View(puberty_sr_wide)
str(puberty_sr)
nonlinear_model <- '
# Growth curve
growth ~ b0 + b1 * age + b2 * age^2
stage ~ dnorm(1 / (1 + exp(-growth)), tau)
# Random effects
growth ~~ 1 * growth
# Residuals
stage ~~ 1 * stage
'
# Fit the mixed effects model using lavaan and lme4
fit <- sem(nonlinear_model, data = data)
# Fit the mixed effects model using lavaan and lme4
fit <- lavaan::sem(nonlinear_model, data = data)
# Fit the mixed effects model using lavaan and lme4
fit <- lavaan::sem(nonlinear_model, data = puberty_sr)
nonlinear_model <- '
# Growth curve
growth ~ b0 + b1 * age + b2 * age^2
stage ~ 1 / (1 + exp(-growth)
# Random effects
growth ~~ 1 * growth
# Residuals
stage ~~ 1 * stage
'
# Fit the mixed effects model using lavaan and lme4
fit <- lavaan::sem(nonlinear_model, data = puberty_sr)
nonlinear_model <- '
# Growth curve
growth ~ b0 + b1 * age + b2 * age^2
stage ~ 1 / (1 + exp(-growth))
# Random effects
growth ~~ 1 * growth
# Residuals
stage ~~ 1 * stage
'
# Fit the mixed effects model using lavaan and lme4
fit <- lavaan::sem(nonlinear_model, data = puberty_sr)
nonlinear_model <- '
# Growth curve
growth ~ b0 + b1 * age + b2 * age^2
stage ~ logistic(growth)
# Random effects
growth ~~ 1 * growth
# Residuals
stage ~~ 1 * stage
'
# Fit the mixed effects model using lavaan and lme4
fit <- lavaan::sem(nonlinear_model, data = puberty_sr)
nonlinear_model <- '
# Growth curve
growth ~ b0 + b1 * age + b2 * age^2
stage ~ 1 / (1 + exp(-growth))
# Random effects
growth ~~ 1 * growth
# Residuals
stage ~~ 1 * stage
'
# Fit the mixed effects model using lavaan and lme4
fit <- lavaan::sem(nonlinear_model, data = puberty_sr)
str(puberty_sr)
nonlinear_model <- '
# Growth curve
growth ~ b0 + b1 * age + b2 * age^2
stage ~ 1 / (1 + exp(-growth)))
# Random effects
growth ~~ 1 * growth
# Residuals
stage ~~ 1 * stage
'
# Fit the mixed effects model using lavaan and lme4
fit <- lavaan::sem(nonlinear_model, data = puberty_sr)
nonlinear_model <- '
# Growth curve
# Intercepts
growth ~ b0 + b1 * age + b2 * age^2
# Logistic growth curve
stage ~ plogis(growth)
# Random effects
# Specify random effects for growth
growth ~~ 1 * growth
# Residuals
# Specify residuals for stage
stage ~~ 1 * stage
'
# Fit the mixed effects model using lavaan and lme4
fit <- lavaan::sem(nonlinear_model, data = puberty_sr)
